<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="icon" type="image/png" sizes="64x64" href="./assets/media/favicon.png">
    <link rel="stylesheet" href="./assets/css/three.css">
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MLGDLC4C');</script>
    <!-- End Google Tag Manager -->
</head>

<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MLGDLC4C"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const container = document.getElementById('container');
        let cube, scene, camera, renderer, uniforms, controls;
        let start = Date.now();

        const fragmentShader = `
            #ifdef GL_ES
            precision highp float;
            #endif

            // glslsandbox uniforms
            uniform float time;
            uniform vec2 resolution;

            // shadertoy emulation
            #define iTime time
            #define iResolution resolution

            #define R iResolution.xy

            float Cir (vec2 uv, float r, bool blur) {
                float a = blur ? 0.01 : 0.;
                float b = blur ? 0.13 : 5./R.y;
                return smoothstep(a, b, length(uv)-r);
            }

            void mainImage( out vec4 fragColor, in vec2 fragCoord){
                vec2 uv = (fragCoord-.5*R.xy)/R.y;
                vec2 t = vec2(sin(iTime*2.), cos(iTime*2.+cos(iTime*.1)))*.1;
                
                vec3 Col0 = vec3(0);
                Col0 = vec3(.7);
                vec3 Col1 = vec3(0);
                Col1 = vec3(.1+uv.y*2., .4+uv.x*-1.1, .8)*.828;
                vec3 Col2 = vec3(0);
                    Col2 = vec3(.97);
                
                float cir1 = Cir(uv-t, .2, true);
                float cir2 = Cir(uv+t, .2, false);
                float cir2B = Cir(uv+t, .17, true);
                
                vec3 col = mix(Col1+vec3(.2,.1,1.), Col2, cir2B);
                col = mix(col, Col0, cir1);
                col = mix(col, Col1, clamp(cir1-cir2, 0., 3.));
                fragColor = vec4(col,1.0);
            }

            void main(void) {
                mainImage(gl_FragColor, gl_FragCoord.xy);
            }
        `;


        function init(){
            scene = new THREE.Scene();
            
            camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
            camera.position.z = 5;
            
            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );
            
            uniforms = {
                time: { value: 0 },
                resolution:  { value: new THREE.Vector3() }
            };
            console.log(uniforms);
            const geometry = new THREE.PlaneGeometry( window.innerWidth, window.innerHeight, 10, 10 );
            geometry.startTime = Date.now();
            geometry.uniforms = uniforms;            
            const material = new THREE.ShaderMaterial( {
                fragmentShader, uniforms,
                // side : THREE.DoubleSide,  // opacity : 0.4, // transparent : true, //depthWrite  : true,
            } );
            cube = new THREE.Mesh( geometry, material );
            scene.add( cube );

            controls = new OrbitControls( camera, renderer.domElement );
            controls.enableDamping = true;
            controls.dampingFactor = 0.2;

            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }
        
        init();

        function animate(time) {
			time *= 0.001; //convert to seconds
            requestAnimationFrame( animate );

            controls.update();

            uniforms.resolution.value.set(window.innerWidth, window.innerHeight, 1);
            var elapsedMilliseconds = Date.now() - cube.startTime;
            var elapsedSeconds = elapsedMilliseconds / 1000.;
            cube.material.uniforms.time.value = time;

            console.log(cube.material.uniforms.time);
            
            renderer.render( scene, camera );
        }
        
        animate();
    </script>

</body>
</html>