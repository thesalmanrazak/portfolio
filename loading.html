<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
    <style>
        #div1 {
            z-index: 100;
            position: fixed;
            bottom: 5px;
            left: 5px;
            width: 40px;
            height: 40px;
            display: flex;
            background: #fff;
            color: #000;
            border: 1px solid #000;
            font-weight: 600;
            font-size: 12px;
            line-height: 40px;
            text-align: center;
            display: block;
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RNP8J0Q06"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0RNP8J0Q06');
</script>
<body>

    <div class="arrowkeys">
        <button type="button" class="up">↑</button>
        <button type="button" class="left">←</button>
        <button type="button" class="down">↓</button>
        <button type="button" class="right">→</button>
        <button type="button" class="space"></button>
    </div>

    <div id="div1" class="div1">
        <div></div>
    </div>

    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';
        import { TWEEN } from 'three/addons/libs/tween.module.min.js';

        const container = document.getElementById('container');
        
        const div = document.querySelector("div#div1");

        let cube, scene, camera, renderer, controls, car;
        let object;
        let tyres = [], rotationSpeed = 0.01;
        const KEYUP             = 38;        // up key
        const KEYDOWN             = 40;        // down key
        const KEYLEFT             = 37;        // left key
        const KEYRIGHT            = 39;        // right key
        const Z_ROT_INC            = 81;
        const Z_ROT_DEC            = 87;
        const VIEW_INCREMENT    = 1;
        var xSpeed = 0.01;
        var ySpeed = 0.01;

        init().then( animate );

        async function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0xffffff );
            
            camera = new THREE.PerspectiveCamera( 35, window.innerWidth/window.innerHeight, 0.01, 1000 );
            camera.position.set(0,0,-10);
            camera.eulerOrder = "YXZ"; // CHANGED
            camera.lookAt(scene.position);
            
            renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true });
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );

            renderer.outputColorSpace = THREE.SRGBColorSpace;

            new RGBELoader().load( './assets/hdri/snow_field_puresky_4k.hdr', function ( texture ) {                
                texture.mapping = THREE.EquirectangularReflectionMapping; //scene.background = texture;
                scene.environment = texture;
            });





            
           
            function loadModel() {
                scene.add( object );

                tyres.push(
                    object.getObjectByName( 'wheel_RF' ),
                    object.getObjectByName( 'wheel_RB' ),
                    object.getObjectByName( 'wheel_LB' ),
                    object.getObjectByName( 'wheel_LF' )
                );

                tyres[0].rotSpeed = { x: 0, y: 0};
                tyres[1].rotSpeed = { x: 0, y: 0};
                tyres[2].rotSpeed = { x: 0, y: 0};
                tyres[3].rotSpeed = { x: 0, y: 0};
                //animate();
            }



            const manager = new THREE.LoadingManager( loadModel );


            function onProgress( xhr ) {
                if ( xhr.lengthComputable ) {
                    const percentComplete = xhr.loaded / xhr.total * 100;
                    //console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' );
                    div.innerHTML = Math.round( percentComplete, 2 );
                }
            }
            function onError() {}

            const loader = new GLTFLoader( manager );

            loader.load( './assets/models/car.gltf', function ( obj ) {
                object = obj.scene;
            }, onProgress, onError );


            


            //setupKeyControls();


            controls = new OrbitControls( camera, renderer.domElement );
            //console.log(controls);
            controls.listenToKeyEvents( window );
            controls.keys = {
                LEFT: 'ArrowLeft', //left arrow
                UP: 'ArrowUp', // up arrow
                RIGHT: 'ArrowRight', // right arrow
                BOTTOM: 'ArrowDown' // down arrow
            }

            window.addEventListener('resize', onWindowResize);
        }

        window.addEventListener(
  "keydown",
  (event) => {
    if (event.defaultPrevented) {
      return; // Do nothing if event already handled
    }

    switch (event.code) {
      case "KeyS":
      case "ArrowDown":
        // Handle "back"
        //updatePosition(-moveRate);
        break;
      case "KeyW":
      case "ArrowUp":
        // Handle "forward"
        //updatePosition(moveRate);
        break;
      case "KeyA":
      case "ArrowLeft":
        console.log(controls);        
        // Handle "turn left"
        //angle -= turnRate;
        //controls.rotation.x += 0.01;
        if(controls.position0.z == -5){
            controls.enabled = false;
        }
        controls.update();
        //new TWEEN.Tween(controls.rotation).to({ x: -5, y: 0, z: 0}, 3000)/*.delay(10).yoyo(true).repeat(Infinity)*/.easing(TWEEN.Easing.Cubic.InOut).start();
        break;
      case "KeyD":
      case "ArrowRight":
        // Handle "turn right"
        //angle += turnRate;
        //controls.rotation.x += 0.01;
        //new TWEEN.Tween(controls.rotation).to({ x: 5, y: 0, z: 0}, 3000)/*.delay(10).yoyo(true).repeat(Infinity)*/.easing(TWEEN.Easing.Cubic.InOut).start();
        break;
    }

    if (event.code !== "Tab") {
      // Consume the event so it doesn't get handled twice,
      // as long as the user isn't trying to move focus away
      event.preventDefault();
    }
  },
  true
);

        function setupKeyLogger() {
            document.onkeydown = function (e) {
                console.log(e);
            }
        }

        function setupKeyControls() {
            var cube = scene.getObjectByName('cube');
            document.onkeydown = function (e) {
                switch (e.keyCode) {
                    case 37:
                        console.log('left');
                        break;
                    case 38:
                        console.log('up');
                        break;
                    case 39:
                        console.log('right');
                        break;
                    case 40:
                        console.log('down');
                        break;
                }
            };
        }

        /*
        document.addEventListener('keydown', function(event) {
            
            if(event.keyCode == 37) {

                console.log('Left was pressed');
                document.querySelector("button.left").classList.add('active');
                //object.position.x -= xSpeed;

            } else if(event.keyCode == 38) {

                console.log('up was pressed');
                document.querySelector("button.up").classList.add('active');
                
                //for ( let i = 0; i < tyres.length; i ++ ) {
                  //  tyres[ i ].rotation.x += 0.5;                    
                //}
                
                //object.position.y += ySpeed;

            } else if(event.keyCode == 39) {

                console.log('Right was pressed');
                document.querySelector("button.right").classList.add('active');
                //object.rotation.y += rotationSpeed;
                //object.position.x -= xSpeed;
                
            } else if(event.keyCode == 40) {

                console.log('down was pressed');
                document.querySelector("button.down").classList.add('active');
                //object.position.y -= ySpeed;

            } else if(event.keyCode == 32) {
                
                console.log('spacebar pressed');
                document.querySelector("button.space").classList.add('active');
                //object.position.set(0,0,0);

            } else if (event.keyCode == 87) {
                //object.position.y += ySpeed;
                console.log(' w pressed ');
            } else if (event.keyCode == 83) {
                //object.position.y -= ySpeed;
                console.log(' s pressed ');
            } else if (event.keyCode == 65) {
                //object.position.x -= xSpeed;
                console.log(' a pressed ');
            } else if (event.keyCode == 68) {
                //object.position.x += xSpeed;
                console.log(' d pressed ');
            }
        });
        */
        /*
        document.addEventListener('keyup', function(event) {
            if(event.keyCode == 37) {

                console.log('Left was released');
                document.querySelector("button.left").classList.remove('active');

            } else if(event.keyCode == 38) {

                console.log('up was released');
                document.querySelector("button.up").classList.remove('active');
                
                for ( let i = 0; i < tyres.length; i ++ ) {
                    tyres[ i ].rotation.x = 0;
                    
                }

            } else if(event.keyCode == 39) {

                console.log('Right was released');
                document.querySelector("button.right").classList.remove('active');
                
            } else if(event.keyCode == 40) {

                console.log('down was released');
                document.querySelector("button.down").classList.remove('active');
                for ( let i = 0; i < tyres.length; i ++ ) {
                    tyres[ i ].rotation.x -= 0.5;
                    
                }

            } else if(event.keyCode == 32) {
                
                console.log('spacebar released');
                document.querySelector("button.space").classList.remove('active');

            }
        });
        */


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }
        var clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame( animate );

            var delta = Math.min( 0.03, clock.getDelta() );
            /*
            if(object){
                for ( let i = 0; i < tyres.length; i ++ ) {
                    tyres[ i ].rotation.x += 0.9;
                    
                }
            }
            */
            //controls.update();

            TWEEN.update();
            
            renderer.render( scene, camera );
        }
    </script>

    <script></script>
</body>
</html>