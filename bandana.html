<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
    <style>
        body{
            background: linear-gradient(to bottom, #d6d6d6 0%,#c5c5c5 100%);
        }
        canvas{
            background: transparent !important;
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HR8J8853HV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HR8J8853HV');
</script>
<body>

<div id="container">
    <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
</div>

    <script src="./assets/js/jquery.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';        
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

        THREE.ColorManagement.enabled = false;

        const container = document.getElementById('container');

        let scene, camera, controls, renderer, bandana;
        let light, ambient;
        let spotLight, lightHelper, gui;
        const color =  0xffffff;
        const intensity = 1.39;

        init();

        function init(){
            scene = new THREE.Scene();
            //scene.background = new THREE.Color( 0xf7f7f7 );
			//scene.fog = new THREE.Fog( 0x443333, 0.2, 0.5 );

            camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
			camera.position.set( 0, 5, 30 );

            renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            container.appendChild( renderer.domElement );
           
            const loader = new THREE.TextureLoader().setPath( './assets/media/bandana/' );
            const filenames = [ '01.jpg', '02.jpg', '03.jpg', '04.jpg', '05.jpg', '06.jpg', '07.jpg', '08.jpg', '09.jpg', '10.jpg', '11.jpg', '12.jpg' ];
            const textures = { none: null }
            const hdriPath = './assets/hdri/';
            const hdrifiles = [ 'industrial_sunset_puresky_4k.hdr', 'aristea_wreck_puresky_4k.hdr' ];
            const hdris = { none: null }

            const mat = new THREE.MeshStandardMaterial({
                map: loader.load( filenames[0] )
            });

            const light = new THREE.AmbientLight(color, intensity);
            scene.add(light);
            console.log(light);

            class ColorGUIHelper {
                constructor(object, prop) {
                    this.object = object;
                    this.prop = prop;
                }
                get value() {
                    return `#${this.object[this.prop].getHexString()}`;
                }
                set value(hexString) {
                    this.object[this.prop].set(hexString);
                }
            }

            //scene.add( new THREE.AmbientLight( 0x404040 ) );
            //scene.add( new THREE.HemisphereLight( 0xffffff, 0xaaaaaa, 1 ) );
            //sceneLight(0);

            new RGBELoader().load( './assets/hdri/'+ hdrifiles[0], function ( texture ) {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                scene.background = texture;
                scene.environment = texture;
                texture.dispose();
            });
            function changeHDRI(hdris) {                
                new RGBELoader().load( hdris, function ( texture ) {
                    texture.mapping = THREE.EquirectangularReflectionMapping;
                    scene.background = texture;
                    scene.environment = texture;
                    texture.dispose();
                    console.log(scene);
                });
            }

            new GLTFLoader().load('./assets/models/bandana.gltf', function(gltf){
                
                bandana = gltf.scene;
                bandana.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.map = loader.load( filenames[0] );
                    }
                } );
                bandana.scale.set(10,10,10);
                bandana.position.y = 18;
                bandana.castShadow = true;
                bandana.receiveShadow = true;
                scene.add( bandana );

            }, function ( xhr ) {
                console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
            }, function ( error ) {
                console.log( 'An error happened' );
            });

            for ( let i = 0; i < hdrifiles.length; i ++ ) {
                const filename = hdrifiles[ i ];
                const hdri = './assets/hdri/'+ filename;
                hdris[ filename ] = hdri;
            }

            for ( let i = 0; i < filenames.length; i ++ ) {
                const filename = filenames[ i ];
                const texture = loader.load( filename );
                texture.minFilter = THREE.LinearFilter;
                texture.magFilter = THREE.LinearFilter;
                texture.colorSpace = THREE.SRGBColorSpace;
                textures[ filename ] = texture;
            }

            gui = new GUI();

            const params = {
                hdri: hdris['industrial_sunset_puresky_4k.hdr'],
                bandana: textures[ '01.jpg' ],
                shadows: true,
            };

            gui.add( params, 'hdri', hdris).onChange( function ( val ) {
                changeHDRI(val);
            } );
            gui.add( params, 'bandana', textures ).onChange( function ( val ) {
                bandana.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.map = val;
                    }
                } );
            } );
            gui.add( params, 'shadows' ).onChange( function ( val ) {
                renderer.shadowMap.enabled = val;
                bandana.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.needsUpdate = true;
                    }
                } );
            } );
            gui.open();

            const controls = new OrbitControls( camera, renderer.domElement );
            controls.minDistance = 20;
            controls.maxDistance = 100;
            controls.maxPolarAngle = Math.PI / 2;
            controls.target.set( 0, 18, 0 );
            controls.update();

            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );            
        }

        function animate() {
            requestAnimationFrame( animate );
            renderer.render( scene, camera );
            if(controls){
                controls.update();
            }            
        }
        animate();

    </script>

</body>
</html>