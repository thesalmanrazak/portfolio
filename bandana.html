<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="icon" type="image/png" sizes="64x64" href="./assets/media/favicon.png">
    <link rel="stylesheet" href="./assets/css/three.css">
    <style>
        body{
            background: linear-gradient(to bottom, #d6d6d6 0%,#c5c5c5 100%);
        }
        canvas{
            background: transparent !important;
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HR8J8853HV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HR8J8853HV');
</script>
<body>

    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
    </div>

    <div id="loading" class="loading">
        <span>Loading</span>
        <h2>100%</h2>
    </div>

    <script src="./assets/js/jquery.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';        
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

        THREE.ColorManagement.enabled = false;

        const container = document.getElementById('container');
        const loading = document.getElementById('loading');

        let scene, camera, controls, renderer, bandana, object;
        let light, ambient;
        let spotLight, lightHelper;
        const color =  0xffffff;
        const intensity = 1.39;

        const textureloader = new THREE.TextureLoader().setPath( './assets/media/bandana/' );
        const filenames = [ '01.jpg', '02.jpg', '03.jpg', '04.jpg', '05.jpg', '06.jpg', '07.jpg', '08.jpg', '09.jpg', '10.jpg', '11.jpg', '12.jpg' ];
        const textures = { none: null }

        for ( let i = 0; i < filenames.length; i ++ ) {
            const filename = filenames[ i ];
            const texture = textureloader.load( filename );
            texture.minFilter = THREE.LinearFilter;
            texture.magFilter = THREE.LinearFilter;
            texture.colorSpace = THREE.SRGBColorSpace;
            textures[ filename ] = texture;
        }

        const hdriPath = './assets/hdri/';
        const hdrifiles = [ 'industrial_sunset_puresky_4k.hdr', 'aristea_wreck_puresky_4k.hdr', 'dl.beatsnoop.com-3000-D4LK8nymIT.hdr' ];
        const hdris = { none: null }
        for ( let i = 0; i < hdrifiles.length; i ++ ) {
            const filename = hdrifiles[ i ];
            const hdri = hdriPath + filename;
            hdris[ filename ] = hdri;
        }

        const params = {
            hdri: hdris['industrial_sunset_puresky_4k.hdr'],
            bandana: textures[ '01.jpg' ],
            shadows: true,
        };

       
        
        init().then( animate );

        async function init(){
            scene = new THREE.Scene(); //scene.background = new THREE.Color( 0xf7f7f7 ); //scene.fog = new THREE.Fog( 0x443333, 0.2, 0.5 );

            camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
			camera.position.set( 0, 5, 30 );

            renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            container.appendChild( renderer.domElement );

            const mat = new THREE.MeshStandardMaterial({ map: textureloader.load( filenames[0] ) });

            function loadModel(){
                scene.add( object );
            }

            const manager = new THREE.LoadingManager( loadModel );

            function onProgress( xhr ) {
                if ( xhr.lengthComputable ) {
                    const percentComplete = xhr.loaded / xhr.total * 100; //console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' );
                    loading.querySelector('h2').innerHTML = Math.round( percentComplete, 2 ) + '%';
                    if(Math.round( percentComplete, 2 ) == 100){
                        setTimeout(function() {
                            loading.style.transition = '.5s';
                            loading.style.opacity = '0';
                            loading.style.visibility = 'hidden';
                        }, 1250);
                    }
                }
            }
            function onError() {}

            const loader = new GLTFLoader( manager );

            loader.load( './assets/models/bandana.gltf', function ( obj ) {
                
                object = obj.scene;
                object.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.map = textureloader.load( filenames[0] );
                        
                    }
                } );
                object.scale.set(10,10,10);
                object.position.y = 18;
                object.castShadow = true;
                object.receiveShadow = true;
                object.name = "Bandana";
                //scene.add( object );

            }, onProgress, onError );

            rgbs();

            lights();

            guis();

            control();

            window.addEventListener('resize', onWindowResize);
        }

        function lights(){
            const light = new THREE.AmbientLight(color, intensity);
            scene.add(light);

            class ColorGUIHelper {
                constructor(object, prop) {
                    this.object = object;
                    this.prop = prop;
                }
                get value() {
                    return `#${this.object[this.prop].getHexString()}`;
                }
                set value(hexString) {
                    this.object[this.prop].set(hexString);
                }
            }
        }

        function rgbs(){
            new RGBELoader().load( './assets/hdri/'+ hdrifiles[0], function ( texture ) {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                scene.background = texture;
                scene.environment = texture;
                texture.dispose();
            });
        }

        function changeHDRI(hdris) {
            new RGBELoader().load( hdris, function ( texture ) {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                scene.background = texture;
                scene.environment = texture;
                texture.dispose();
            });
        }

        function guis(){
            const gui = new GUI();
            gui.add( params, 'hdri', hdris).onChange( function ( val ) {
                changeHDRI(val);
            } );
            gui.add( params, 'bandana', textures ).onChange( function ( val ) {
                object.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.map = val;
                    }
                } );
            } );
            gui.add( params, 'shadows' ).onChange( function ( val ) {
                renderer.shadowMap.enabled = val;
                object.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.needsUpdate = true;
                    }
                } );
            } );
            gui.open();
        }

        function control(){
            controls = new OrbitControls( camera, renderer.domElement );
            controls.enableDamping = true;
            controls.minDistance = 20;
            controls.maxDistance = 100;
            controls.maxPolarAngle = Math.PI / 2;
            controls.target.set( 0, 18, 0 );            
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );            
        }

        function animate() {
            requestAnimationFrame( animate );            
            if(controls){
                controls.update();
            }
            render();
        }

        function render(){
            renderer.render( scene, camera );
        }
    </script>

</body>
</html>