<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RNP8J0Q06"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0RNP8J0Q06');
</script>
<body>

    <div id="webgl"></div>
    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('threejs.html');">Back</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    
    <script type="module">
        import * as THREE from 'three';

        const container = document.getElementById('container');
        let cube, scene, camera, renderer, loader, geometry, material, mesh, raycaster;

        function init(){
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, 1000 );
            camera.position.set(0, 0, 100);

            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );

            const uniforms = {
                uTime: { value: 0.0 },
                uMouseX: { value: 0.0 },
                uMouseY: { value: 0.0 },
                uTexture: { value: new THREE.TextureLoader().load('./assets/media/market.jpg') },
                uImageAspect: { value: 1920 / 1280 },
                uPlaneAspect: { value: 800 / 500 },
            };
            geometry = new THREE.PlaneGeometry(800, 500, 100, 100);
            material = new THREE.ShaderMaterial({
                uniforms,
                vertexShader: `
                    varying vec2 vUv;
                    uniform float uTime;
                    uniform float uMouseX;
                    uniform float uMouseY;

                    float PI = 3.141592;
                    void main(){
                        vUv = uv;
                        vec3 pos = position;
                        float offset = 0.005;
                        float freq = 0.5;
                        float amp = 20.0;
                        pos.x = pos.x + sin(pos.x * offset + uMouseX * freq * PI ) * amp;
                        pos.y = pos.y + cos(sin(pos.x * offset + uMouseY * freq * PI) ) * amp;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec2 vUv;
                    uniform sampler2D uTexture;
                    uniform float uImageAspect;
                    uniform float uPlaneAspect;
                    uniform float uMouseX;
                    uniform float uMouseY;
    
                    void main(){
                        vec2 ratio = vec2(min(uPlaneAspect / uImageAspect, 1.0), min((1.0 / uPlaneAspect) / (1.0 / uImageAspect), 1.0));
                        vec2 fixedUv = vec2((vUv.x - 0.5) * ratio.x + 0.5, (vUv.y - 0.5) * ratio.y + 0.5);
                        vec3 rgb = vec3(0.0);
                        rgb.r = texture2D(uTexture, vUv + vec2(0., sin(uMouseX * 5.0) * 0.01)).r;
                        rgb.g = texture2D(uTexture, vUv + vec2(cos(uMouseX * 5.0) * 0.01), 0.).g;
                        rgb.b = texture2D(uTexture, vUv + cos(uMouseY * 5.0) * 0.01).b;
    
                        vec3 texture = texture2D(uTexture, fixedUv).rgb;
                        gl_FragColor = vec4(rgb,1.0) * vec4(texture, 1.0);
                    }
                `,
            });
            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            raycaster = new THREE.Raycaster();
            document.addEventListener("mousemove", (event) => {
                const mouse = new THREE.Vector2();
                mouse.x = (event.clientX / window.innerWidth) * 2.0 - 1.0;
                mouse.y = (event.clientY / window.innerHeight) * 2.0 - 1.0;
                
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObject(mesh);
                if (intersects.length > 0) {
                    mesh.material.uniforms.uMouseX.value = mouse.x;
                    mesh.material.uniforms.uMouseY.value = mouse.y;
                }
            });

            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();

        function animate() {
            requestAnimationFrame( animate );            
            renderer.render( scene, camera );
        }
        
        animate();
    </script>

</body>
</html>