<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RNP8J0Q06"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0RNP8J0Q06');
</script>
<body>

    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
        <div class="wrapper">
            <div class="device vertical" id="device">
                <div id="deviceLoading" class="deviceLoading">
                    <span>Loading</span>
                    <h2>100%</h2>
                </div>
            </div>
            <div class="keyboard">
                <button type="button" class="btn_up">▲</button>
                <button type="button" class="btn_left">◄</button>
                <button type="button" class="btn_down">▼</button>
                <button type="button" class="btn_right">►</button>
                <!--<button type="button" class="btn_spacebar">1</button>-->
            </div>
            <div class="toggle">
                <input type="checkbox" id="toggle" checked>
            </div>
        </div>
        
    </div>


    <script src="./assets/js/jquery.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';

        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { Lensflare, LensflareElement } from 'three/addons/objects/Lensflare.js';
        import { TWEEN } from 'three/addons/libs/tween.module.min.js';
        import { GroundProjectedSkybox } from 'three/addons/objects/GroundProjectedSkybox.js';

        const container = document.getElementById('container');
        const loading = document.getElementById('deviceLoading');

        let camera, controls, scene, renderer;
        let object, car, objectPosition = 0, skybox;
        let tyres = [], rinGroup;
        let spotLight, lightHelper;
        let carlight, hlight1, hlight2, lensflare1, lensflare2;
        let material;
        let textureLoader = new THREE.TextureLoader();
        let textureFlare0 = textureLoader.load( './assets/media/lensflare/lensflare0_alpha.png' );
        let textureFlare3 = textureLoader.load( './assets/media/lensflare/lensflare0_alpha.png' );
        let textureFlare1 = textureLoader.load( './assets/media/lensflare/carlight.png' );
        let cloudMap = textureLoader.load( './assets/media/belfast_sunset_puresky_4k.png' );
        let camX = 0, camY = 3, camZ = -5;
        let grid, sphere;
        let ringSize = 2.0;
        let axehelper = new THREE.AxesHelper(5);

        const basic = {
            axe: false,
        }
        const params = {
            tonemap: 0.65,
            punctualLightsEnabled: true,
            color: '#dddddd',
            break: 0,
            headlight: 0.1,
            tyrerotate: 0.0,
            tyre: false,            
            shadow: true,            
        };
        const glassparams = {
            color: 0xffffff,
            transmission: 1,
            opacity: 1,
            metalness: 0,
            roughness: 0,
            ior: 1.5,
            thickness: 0.01,
            specularIntensity: 1,
            specularColor: 0xffffff,
            envMapIntensity: 1,
            lightIntensity: 1,
            exposure: 1
        };
        

        init().then( animate );
        
        async function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x111111 );
            scene.fog = new THREE.Fog(0x9977eb, 1, 0.05);
            
            camera = new THREE.PerspectiveCamera( 75, device.clientWidth / device.clientHeight, 0.01, 1000 );
            camera.position.set( camX, camY, camZ );
            camera.rotation.order = "YXZ";
            const camhelper = new THREE.CameraHelper( camera );
            scene.add( camhelper );
            
            renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true });
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( device.clientWidth, device.clientHeight );
            renderer.shadowMap.enabled = params.shadow;
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = params.tonemap;
            device.appendChild( renderer.domElement );

            controls = new OrbitControls( camera, renderer.domElement );
            controls.enableDamping = true;
            controls.dampingFactor = 0.2;
            /*
            controls.enableZoom = false;
            controls.enablePan = false;
            
            controls.minDistance = 1;
            controls.maxDistance = 40;
            controls.target.set( 0, 2, 0 );
            controls.maxPolarAngle = Math.PI / 2;
            */


            




            new RGBELoader().load( './assets/hdri/rustig_koppie_puresky_4k.hdr', function ( hdri ) {
                hdri.mapping = THREE.EquirectangularReflectionMapping;
                scene.background = hdri;
                scene.environment = hdri;

                /*
                skybox = new GroundProjectedSkybox( hdri );
                skybox.scale.setScalar( 50 );                
                scene.add( skybox );
                */
                
            });
            
            function loadModel(){
                scene.add( object );
            }

            const manager = new THREE.LoadingManager( loadModel );

            function onProgress( xhr ) {
                if ( xhr.lengthComputable ) {
                    const percentComplete = xhr.loaded / xhr.total * 100; //console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' );
                    loading.querySelector('h2').innerHTML = Math.round( percentComplete, 2 ) + '%';
                    if(Math.round( percentComplete, 2 ) == 100){
                        setTimeout(function() {
                            loading.style.transition = '.5s';
                            loading.style.opacity = '0';
                            loading.style.visibility = 'hidden';
                        }, 1250);
                    }
                }
            }
            function onError() {}

            const loader = new GLTFLoader( manager );

            loader.load( './assets/models/car4.gltf', function ( obj ) {
                
                // define gltf model and add into scene
                object = obj.scene;
                object.name = "Car";
                object.traverse(function (o) {
                    if (o.isMesh) {
                        o.castShadow = true;
                        o.receiveShadow = false;
                    }
                });
                object.rotation.set( 0, 0, 0 );
                //object.position.set( 0, objectPosition, 0 );                


                /*
                // car body paint color define
                object.getObjectByName('bodypaint', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = new THREE.Color(params.color);
                        o.material.metalness = 0.8,
					    o.material.roughness = 0,
                        o.material.envMap = scene.background;
                        o.material.envMapIntensity = 0.5;
                        o.castShadow = true;
                        o.receiveShadow = false;
                        o.material.needsUpdate = true;
                    }
                    
                });
                */
                
                // show shadow of car
                carshadow(1,1000,0x000000,0.4,0);

                sceneLight(1,0,2048);


            }, onProgress, onError );
            
            window.addEventListener('resize', onWindowResize);
        }

        function carshadow(show,size,color,opacity,y){
            if(show==1){
                const planeGeometry = new THREE.PlaneGeometry( size,size );
                planeGeometry.rotateX( - Math.PI / 2 );
                const planeMaterial = new THREE.ShadowMaterial( { color:color, opacity: opacity } );                
                const plane = new THREE.Mesh( planeGeometry, planeMaterial );
                plane.position.y = y;
                plane.receiveShadow = true;
                object.add(plane);            
            }
        }

        function sceneLight(show,showHelper,size){
            if(show == 1){

                scene.add( new THREE.AmbientLight( 0xffffff, 2.05 ) );

                const light = new THREE.DirectionalLight(0xeeeeee, 4);            
                light.position.set(-8,20,10);
                scene.add(light);

                light.castShadow = true;
                light.shadow.mapSize.width = size;
                light.shadow.mapSize.height = size;
                light.shadow.camera.near = 10;
                light.shadow.camera.far = 200;
                light.shadow.focus = 1;

                const hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.1 );
                hemiLight.color.setHSL( 0.6, 1, 0.6 );
                hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
                hemiLight.position.set( 0, 0, 0 );
                scene.add( hemiLight );

                if(showHelper == 1){
                    scene.add( new THREE.DirectionalLightHelper( light, 5 ) );
                    scene.add( new THREE.HemisphereLightHelper( hemiLight, 5 ) );
                }

            }
        }
        function onWindowResize() {
            camera.aspect = device.clientWidth / device.clientHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(device.clientWidth, device.clientHeight);
        }
        
        function animate() {
            requestAnimationFrame( animate );

            TWEEN.update();
            
            if(controls){
                controls.update();
            }

            if(grid){
                const time = - performance.now() / 1000;
                grid.position.z = + ( time ) % 1;
            }

            if(sphere){
                sphere.rotation.x -= 0.01;
                //sphere.rotation.y += 0.01;
                //sphere.rotation.z += 0.001;
            }

            renderer.render( scene, camera );
        }
    
        jQuery(function($){
            $('.wrapper #toggle').on('change', function(event){
                
                if( $(this).prop('checked') ){
                    $(this).closest('.wrapper').find('.device').addClass('vertical');
                } else {                    
                    $(this).closest('.wrapper').find('.device').removeClass('vertical');
                }
                requestAnimationFrame( animate );
                renderer.render( scene, camera );

                
            })
        })
    </script>

</body>
</html>