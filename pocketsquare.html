<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
    <style>
        body{
            background: linear-gradient(to bottom, #d6d6d6 0%,#c5c5c5 100%);
        }
        canvas{
            background: transparent !important;
        }
    </style>
</head>
<body>

<div id="container">
    <button type="button" class="backBtn" onclick="window.location.replace('threejs.html');">Back</button>
</div>

    <script src="./assets/js/jquery.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';        
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

        THREE.ColorManagement.enabled = false;

        const container = document.getElementById('container');

        let scene, camera, controls, renderer, pocketsquare;
        let light, ambient;
        let spotLight, lightHelper;

        init();

        function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0xf7f7f7 );
			//scene.fog = new THREE.Fog( 0x443333, 0.2, 0.5 );

            camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
			camera.position.set( 0, 6, 12 );

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );            
            container.appendChild( renderer.domElement );

            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1;

            ambient = new THREE.HemisphereLight( 0xffffff, 0x444444, 0.05 );
			scene.add( ambient );

            const loader = new THREE.TextureLoader().setPath( './assets/media/pocketsquare/' );
            const filenames = [ '01.jpg', '02.jpg', '03.jpg', '04.jpg', '05.jpg', '06.jpg', '07.jpg', '08.jpg', '09.jpg', '10.jpg', '11.jpg', '12.jpg', '13.jpg', '14.jpg', '15.jpg', '16.jpg', '17.jpg', '18.jpg', '19.jpg', '20.jpg', '21.jpg', '22.jpg', '23.jpg', '24.jpg', '25.jpg', '26.jpg', '27.jpg', '28.jpg', '29.jpg', '30.jpg', '31.jpg', '32.jpg', '33.jpg', '34.jpg', '35.jpg', '36.jpg', '37.jpg', '38.jpg', '39.jpg', '40.jpg', '41.jpg', '42.jpg', '43.jpg' ];
            const textures = { none: null }
            const hdriPath = './assets/hdri/';
            const hdrifiles = [ 'industrial_sunset_puresky_4k.hdr', 'snow_field_2_puresky_4k.hdr' ];
            const hdris = { none: null }

            const mat = new THREE.MeshStandardMaterial({
                //map: loader.load( filenames[0] )
                map: loader.load(loader.load( filenames[0] ), texture => {
                    texture.flipY = false
                })
            })

            scene.add( new THREE.AmbientLight( 0x404040 ) );
            scene.add( new THREE.HemisphereLight( 0xffffff, 0xaaaaaa, 1 ) );
            sceneLight(0);

            new RGBELoader().load( './assets/hdri/'+ hdrifiles[0], function ( texture ) {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                scene.background = texture;
                scene.environment = texture;
                texture.dispose();
            });
            //changeHDRI();
            function changeHDRI(hdris) {                
                new RGBELoader().load( hdris, function ( texture ) {
                    texture.mapping = THREE.EquirectangularReflectionMapping;
                    scene.background = texture;
                    scene.environment = texture;
                    texture.dispose();
                    console.log(scene);
                });
            }

            new GLTFLoader().load('./assets/models/pocketsquare.gltf', function(gltf){
                
                pocketsquare = gltf.scene;
                pocketsquare.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.map = loader.load( filenames[0] );
                    }
                } );
                //pocketsquare.scale.set(2,2,2);
                pocketsquare.position.set(0,0,0);
                pocketsquare.castShadow = true;
                pocketsquare.receiveShadow = true;
                scene.add( pocketsquare );

            }, function ( xhr ) {
                console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
            }, function ( error ) {
                console.log( 'An error happened' );
            });

            for ( let i = 0; i < hdrifiles.length; i ++ ) {
                const filename = hdrifiles[ i ];
                const hdri = './assets/hdri/'+ filename;
                hdris[ filename ] = hdri;
            }

            for ( let i = 0; i < filenames.length; i ++ ) {
                const filename = filenames[ i ];
                const texture = loader.load( filename );
                texture.minFilter = THREE.LinearFilter;
                texture.magFilter = THREE.LinearFilter;
                texture.colorSpace = THREE.SRGBColorSpace;
                textures[ filename ] = texture;
            }

            const gui = new GUI();

            const params = {
                hdri: hdris['industrial_sunset_puresky_4k.hdr'],
                pocketsquare: textures[ '01.jpg' ],
                shadows: true
            };

            gui.add( params, 'hdri', hdris).onChange( function ( val ) {
                changeHDRI(val);
            } );

            gui.add( params, 'pocketsquare', textures ).onChange( function ( val ) {
                pocketsquare.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.map = val;
                    }
                } );
            } );

            gui.add( params, 'shadows' ).onChange( function ( val ) {
                renderer.shadowMap.enabled = val;
                bandana.traverse( function ( o ) {
                    if ( o.material ) {
                        o.material.needsUpdate = true;
                    }
                } );
            } );

            gui.open();

            controls = new OrbitControls( camera, renderer.domElement );
            controls.minDistance = 4;
            controls.maxDistance = 50;
            controls.maxPolarAngle = Math.PI / 2; //controls.target.set( 0, 15, 10 );
            controls.update();

            window.addEventListener('resize', onWindowResize);
        }

        function sceneLight(show){
            spotLight = new THREE.SpotLight( 0xffffff, 5 );
            spotLight.position.set( 0, 50, 25 );
            spotLight.angle = Math.PI / 6;
            spotLight.penumbra = 1;
            spotLight.decay = 2;
            spotLight.distance = 100;

            spotLight.castShadow = true;
            spotLight.shadow.mapSize.width = 1024;
            spotLight.shadow.mapSize.height = 1024;
            spotLight.shadow.camera.near = 10;
            spotLight.shadow.camera.far = 200;
            spotLight.shadow.focus = 1;
            scene.add( spotLight );
            if(show == 1){
                lightHelper = new THREE.SpotLightHelper( spotLight );
                scene.add( lightHelper );
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );            
        }

        function animate() {
            requestAnimationFrame( animate );
            renderer.render( scene, camera );
            pocketsquare.rotation.y += 0.001;
            if(controls){
                controls.update();
            }            
        }
        animate();

    </script>

</body>
</html>