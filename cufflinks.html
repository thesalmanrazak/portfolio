<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
    <style>
        canvas{
            background: radial-gradient( circle at top left, #222222, #181813);
        }
        #div1 {
            z-index: 100;
            position: fixed;
            bottom: 5px;
            left: 5px;
            width: 40px;
            height: 40px;
            display: flex;
            background: #fff;
            color: #000;
            border: 1px solid #000;
            font-weight: 600;
            font-size: 12px;
            line-height: 40px;
            text-align: center;
            display: block;
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RNP8J0Q06"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0RNP8J0Q06');
</script>
<body>

    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
    </div>

    <div id="loading" class="loading">
        <span>Loading</span>
        <h2>100%</h2>
    </div>

    <script src="./assets/js/jquery.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>    
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

        const container = document.getElementById('container');
        const loading = document.getElementById('loading');

        let camera, controls, scene, renderer, stats;
        let hlight, light, light2, light3, light4, directionalLight, object;
        let color = 0xf0f0f0, texture, circle, cubeRenderTarget;
        let spotLight = new THREE.SpotLight( 0xffffff ), SpotLightHelper, cameraTarget;

        let files = [ 'cufflinks.gltf', 'cufflinks1.gltf' ];
        let path = './assets/models/';
        
        const env = {
            env: false,
        }
        const art = {
            color: new THREE.Color(0x4c6d46),
            roughness: 0.9,
            metalness: 0.5,
            shininess: 200,
            specular: new THREE.Color(0xb2a61f),
            exposure: 1.0,
            envMapIntensity: 0.5,
            debug: false,
        };
        const base = {
            color: new THREE.Color(0xf7f7f7),
            roughness: 0.1,
            metalness: 1,
            envMapIntensity: 0.9,
        };

        init().then(animate);

        async function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x72645b );
			scene.fog = new THREE.Fog( 0x72645b, 2, 0.015 );

            camera = new THREE.PerspectiveCamera( 55, window.innerWidth / window.innerHeight, 0.01, 1000 );
            camera.position.set( 0, 0, 10 );
            
            renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.shadowMap.enabled = true;
            container.appendChild( renderer.domElement );

            renderer.outputColorSpace = THREE.SRGBColorSpace;
            renderer.toneMappingExposure = 1;
            renderer.gammaOutput = true;
            
            new RGBELoader().load( './assets/hdri/snow_field_puresky_4k.hdr', function ( hdri ) {
                hdri.mapping = THREE.EquirectangularReflectionMapping;
                scene.background = null;
                hdri.colorSpace = THREE.SRGBColorSpace;
                scene.environment = hdri;
            });

            function loadModel() {

                sceneLight(1,0);

                object.castShadow = true;
				object.receiveShadow = true;
                object.rotation.x = -0.35;
                scene.add( object );                
                
                const material = new THREE.MeshPhongMaterial( { color: 0xd5d5d5, specular: 0x494949, shininess: 200 } );
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        //o.material = material
                        
                        o.material.color = art.color;
                        o.material.metalness = art.metalness;
                        o.material.specular = art.specular;                        
                        o.material.shininess = art.shininess;
					    o.material.roughness = art.roughness;
                        o.material.envMap = scene.background;
                        o.material.exposure = art.exposure;
                        o.material.envMapIntensity = art.envMapIntensity;
                        o.castShadow = true;
                        o.receiveShadow = false;
                        o.material.needsUpdate = true;
                        
                    }
                });

                object.getObjectByName('base', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = base.color;
                        o.material.metalness = base.metalness;
                        o.material.roughness = base.roughness;
                        o.material.envMap = scene.environment;
                        o.envMapIntensity = base.envMapIntensity;
                        o.material.side = THREE.DoubleSide;
                    }
                });

                object.getObjectByName('capsule', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = base.color;
                        o.material.metalness = base.metalness;
                        o.material.roughness = base.roughness;
                        o.material.envMap = scene.environment;
                        o.envMapIntensity = base.envMapIntensity;
                        o.material.side = THREE.DoubleSide;
                    }
                });

                const gui = new GUI();

                gui.add( env, 'env' ).onChange( function(val){
                    if(val==true){
                        scene.background = scene.environment;
                    } else {
                        scene.background = null;
                    }
                });

                const subject = gui.addFolder('Subject Setting');

                subject.addColor( art, 'color' ).onChange( function(val){
                    object.getObjectByName('art', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.color = val;
                        }
                    });
                } );
                subject.addColor( art, 'specular' ).onChange( function(val){
                    object.getObjectByName('art', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.specular = val;
                        }
                    });
                } )
				subject.add( art, 'shininess', 0, 200, 1 ).onChange( function(val){
                    object.getObjectByName('art', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.shininess = val;
                        }
                    });
                } );
				subject.add( art, 'roughness', 0, 1, 0.01 ).onChange( function(val){
                    object.getObjectByName('art', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.roughness = val;
                        }
                    });
                } );
				subject.add( art, 'metalness', 0, 1, 0.01 ).onChange( function(val){
                    object.getObjectByName('art', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.metalness = val;
                        }
                    });
                } );
				subject.add( art, 'exposure', 0, 2, 0.01 ).onChange( function(val){
                    object.getObjectByName('art', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.exposure = val;
                        }
                    });
                } );
				subject.add( art, 'debug', false );

                const metal = gui.addFolder('Metal Setting');

                metal.addColor( base, 'color' ).onChange( function(val){
                    object.getObjectByName('base', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.color = val;
                        }
                    });
                    object.getObjectByName('capsule', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.color = val;
                        }
                    });
                } )
				metal.add( base, 'roughness', 0.1, 0.25, 0.01 ).onChange( function(val){
                    object.getObjectByName('base', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.roughness = val;
                        }
                    });
                    object.getObjectByName('capsule', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.roughness = val;
                        }
                    });
                } );
				metal.add( base, 'metalness', 0.5, 1, 0.01 ).onChange( function(val){
                    object.getObjectByName('base', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.metalness = val;
                        }
                    });
                    object.getObjectByName('capsule', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.metalness = val;
                        }
                    });
                } );
                metal.add( base, 'envMapIntensity', 0.5, 1, 0.01 ).onChange( function(val){
                    object.getObjectByName('base', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.envMapIntensity = val;
                        }
                    });
                    object.getObjectByName('capsule', true).traverse ( ( o ) => {
                        if ( o.isMesh ) {
                            o.material.envMapIntensity = val;
                        }
                    });
                } );

                subject.close(); metal.close();

				gui.open();

                scene.add( new THREE.HemisphereLight( 0x8d7c7c, 0x494966 ) );

                addShadowedLight( 1, 1, 1, 0xffffff, 1.35 );
				//addShadowedLight( 0.5, 1, - 1, 0xffd500, 1 );
            
            }

            const manager = new THREE.LoadingManager( loadModel );

            function onProgress( xhr ) {
                if ( xhr.lengthComputable ) {
                    const percentComplete = xhr.loaded / xhr.total * 100; //console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' );
                    loading.querySelector('h2').innerHTML = Math.round( percentComplete, 2 ) + '%';
                    if(Math.round( percentComplete, 2 ) == 100){
                        setTimeout(function() {
                            loading.style.transition = '.5s';
                            loading.style.opacity = '0';
                            loading.style.visibility = 'hidden';
                        }, 1250);
                    }
                }
            }
            function onError() {}

            const loader = new GLTFLoader( manager );

            loader.load( './assets/models/cufflinks.gltf', function ( obj ) {

                object = obj.scene;                
                object.name = "Currlink";

            }, onProgress, onError );





















            controlSetting();

            window.addEventListener('resize', onWindowResize);
        }

        function addShadowedLight( x, y, z, color, intensity ) {
            const directionalLight = new THREE.DirectionalLight( color, intensity );
            directionalLight.position.set( x, y, z );
            scene.add( directionalLight );
            directionalLight.castShadow = true;
            const d = 1;
            directionalLight.shadow.camera.left = - d;
            directionalLight.shadow.camera.right = d;
            directionalLight.shadow.camera.top = d;
            directionalLight.shadow.camera.bottom = - d;
            directionalLight.shadow.camera.near = 1;
            directionalLight.shadow.camera.far = 4;
            directionalLight.shadow.bias = - 0.002;
        }

        function controlSetting(){
            controls = new OrbitControls( camera, renderer.domElement );
            controls.enableDamping = true;
            //controls.maxAzimuthAngle = -4;
            //controls.minAzimuthAngle = 4;
            controls.minDistance = 2;
            controls.maxDistance = 20;
            controls.minPolarAngle = Math.PI/2;
            controls.maxPolarAngle = Math.PI/2;
        }

        function sceneLight(show,guishow){
            if(show == 1){

                class ColorGUIHelper {
                    constructor(object, prop) {
                        this.object = object;
                        this.prop = prop;
                    }
                    get value() {
                        return `#${this.object[this.prop].getHexString()}`;
                    }
                    set value(hexString) {
                        this.object[this.prop].set(hexString);
                    }
                }
                
                const color = 0xFFFFFF;
                const intensity = 1;
                const light = new THREE.AmbientLight(color, intensity);
                scene.add(light);

                if(guishow == 1){                
                    const gui = new GUI();
                    gui.addColor(new ColorGUIHelper(light, 'color'), 'value').name('color');
                    gui.add(light, 'intensity', 0, 2, 0.01);
                }
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
            animate();
        }
        
        function animate(timer) {
            requestAnimationFrame( animate );

            timer = Date.now() * 0.0005;

            camera.position.x = Math.cos( timer ) * 3;
            camera.position.z = Math.sin( timer ) * 3;
            
            //camera.lookAt(  );

            //stats.update();

            if(controls){
                controls.update();                
            }
            renderer.render( scene, camera );
        }
    </script>

</body>
</html>