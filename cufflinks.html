<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak :|: Being creative mean be different...</title>
<link rel="icon" type="image/png" sizes="64x64" href="./assets/media/favicon.png">
    <link rel="stylesheet" href="./assets/css/three.css">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HR8J8853HV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HR8J8853HV');
</script>
<body>

    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
    </div>

    <div id="loading" class="loading">
        <span>Loading</span>
        <h2></h2>
    </div>

    <script src="./assets/js/jquery.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>    
    <script type="module">
        import * as THREE from 'three';

        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { OrbitControls } from './assets/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';
        import { RectAreaLightHelper } from 'three/addons/helpers/RectAreaLightHelper.js';
		import { RectAreaLightUniformsLib } from 'three/addons/lights/RectAreaLightUniformsLib.js';

        const container = document.getElementById('container');
        const loading = document.getElementById('loading');

        let cube, scene, camera, renderer, controls, object, clock, tyres = [], stats, groundMirror, hemiLight, spotLight, shadowplane, mshStdFloor;
        const group = new THREE.Group();

        const art = {
            color: new THREE.Color( 0x006110 ),
            roughness: 0,
            metalness: 0.36,
            shininess: 124,
            specular: new THREE.Color( 0x000000 ),
            exposure: 1.14,
            envMapIntensity: 1,
            debug: false,
        };
        const base = {
            color: new THREE.Color( 0x0d1211 ),
            roughness: 0.21,
            metalness: 0.72,
            envMapIntensity: 0.86,
        };

        init().then( animate );

        async function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x1f1f1f );

            camera = new THREE.PerspectiveCamera( 55, window.innerWidth / window.innerHeight, 0.01, 1000 );
            camera.position.set( 0, 0, 3 );

            clock = new THREE.Clock();

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.outputColorSpace = THREE.LinearSRGBColorSpace;
            renderer.setSize( window.innerWidth, window.innerHeight );            
            container.appendChild( renderer.domElement );
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1;
            container.appendChild( renderer.domElement );

            RectAreaLightUniformsLib.init();
            
            function loadModel(){
                scene.add( object );

                control();

                rgb();

                //spot(0xffffff,0,-5,5,1); // front
                //spot(0xffffff,0,-5,-5,1); // back

                rectLight( 0xffffff, 2, 30, 30, 0, 2, 8, 0 ); // top
                rectLight( 0xffffff, 2, 30, 30, 0, -2, -8, 0 ); // bottom

                guis();
                
            }

            const manager = new THREE.LoadingManager( loadModel );

            function onProgress( xhr ) {
                if ( xhr.lengthComputable ) {
                    const percentComplete = xhr.loaded / xhr.total * 100; //console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' );
                    loading.querySelector('h2').innerHTML = Math.round( percentComplete, 2 ) + '%';
                    if(Math.round( percentComplete, 2 ) == 100){
                        setTimeout(function() {
                            loading.style.transition = '.5s';
                            loading.style.opacity = '0';
                            loading.style.visibility = 'hidden';
                        }, 1250);
                    }
                }
            }
            function onError() {}

            const loader = new GLTFLoader( manager );

            loader.load( './assets/models/cufflinks.gltf', function ( obj ) {
                
                object = obj.scene;
                object.name = "Currlink";
                object.castShadow = true;
				object.receiveShadow = true;
                object.position.y = 0.25;
                object.rotation.x = -0.45;

                const material = new THREE.MeshPhongMaterial( { color: 0xd5d5d5, specular: 0x494949, shininess: 200 } );
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        //o.material = material
                        
                        o.material.color = art.color;
                        o.material.metalness = art.metalness;
                        o.material.specular = art.specular;                        
                        o.material.shininess = art.shininess;
					    o.material.roughness = art.roughness;
                        o.material.envMap = scene.background;
                        o.material.exposure = art.exposure;
                        o.material.envMapIntensity = art.envMapIntensity;
                        o.castShadow = true;
                        o.receiveShadow = false;
                        o.material.needsUpdate = true;
                        
                    }
                });
                object.getObjectByName('base', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = base.color;
                        o.material.metalness = base.metalness;
                        o.material.roughness = base.roughness;
                        o.material.envMap = scene.environment;
                        o.envMapIntensity = base.envMapIntensity;
                        o.material.side = THREE.DoubleSide;
                    }
                });
                object.getObjectByName('capsule', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = base.color;
                        o.material.metalness = base.metalness;
                        o.material.roughness = base.roughness;
                        o.material.envMap = scene.environment;
                        o.envMapIntensity = base.envMapIntensity;
                        o.material.side = THREE.DoubleSide;
                    }
                });
                
                

            }, onProgress, onError );

            window.addEventListener('resize', onWindowResize);
        }

        function rectLight(color,intensity,width,height,x,y,z,show){
            const rectLight = new THREE.RectAreaLight( color, intensity, width, height );
            rectLight.position.set( x, y, z );
            rectLight.lookAt( object.position );            
            scene.add( rectLight );

            if(show == 1){
                scene.add( new RectAreaLightHelper( rectLight ) );
            }
        }

        function rgb(){
            new RGBELoader().load( './assets/hdri/snow_field_puresky_4k.hdr', function ( texture ) {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                //scene.background = texture;
                scene.environment = texture;
                render();
            } );
        }

        function spot(color,x,y,z,show){
            const spotLight = new THREE.SpotLight( color, 1 );
            spotLight.position.set( x, y, z );
            spotLight.lookAt( object.position );
            scene.add( spotLight );
            if( show== 1 ){
                const spotLightHelper = new THREE.SpotLightHelper( spotLight );
                scene.add( spotLightHelper );
            }
        }

        function guis(){
            const gui = new GUI();

            const subject = gui.addFolder('Artwork');

            subject.addColor( art, 'color' ).onChange( function(val){
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = val;
                    }
                });
            } );
            subject.addColor( art, 'specular' ).onChange( function(val){
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.specular = val;
                    }
                });
            } )
            subject.add( art, 'shininess', 0, 200, 1 ).onChange( function(val){
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.shininess = val;
                    }
                });
            } );
            subject.add( art, 'roughness', 0, 1, 0.01 ).onChange( function(val){
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.roughness = val;
                    }
                });
            } );
            subject.add( art, 'metalness', 0, 1, 0.01 ).onChange( function(val){
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.metalness = val;
                    }
                });
            } );
            subject.add( art, 'exposure', 0, 2, 0.01 ).onChange( function(val){
                object.getObjectByName('art', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.exposure = val;
                    }
                });
            } );

            subject.open();

            const metal = gui.addFolder('Metal Setting');

            metal.addColor( base, 'color' ).onChange( function(val){
                object.getObjectByName('base', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = val;
                    }
                });
                object.getObjectByName('capsule', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.color = val;
                    }
                });
            } )
            metal.add( base, 'roughness', 0.1, 0.25, 0.01 ).onChange( function(val){
                object.getObjectByName('base', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.roughness = val;
                    }
                });
                object.getObjectByName('capsule', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.roughness = val;
                    }
                });
            } );
            metal.add( base, 'metalness', 0.5, 1, 0.01 ).onChange( function(val){
                object.getObjectByName('base', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.metalness = val;
                    }
                });
                object.getObjectByName('capsule', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.metalness = val;
                    }
                });
            } );
            metal.add( base, 'envMapIntensity', 0.5, 1, 0.01 ).onChange( function(val){
                object.getObjectByName('base', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.envMapIntensity = val;
                    }
                });
                object.getObjectByName('capsule', true).traverse ( ( o ) => {
                    if ( o.isMesh ) {
                        o.material.envMapIntensity = val;
                    }
                });
            } );

            //subject.close(); metal.close();

            gui.open();
        }

        function control(){
            controls = new OrbitControls( camera, renderer.domElement ); //controls.minPolarAngle = Math.PI/2;
            controls.maxPolarAngle = Math.PI/2;
            controls.enableDamping = true;
            controls.maxDistance = 15;
            controls.minDistance = 1;            
            controls.target.set( 0, 0.5, 0 ); // controls.update();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
            animate();
        }
        
        function animate(time) {
            requestAnimationFrame( animate );

            time = clock.getElapsedTime() / 10; // seconds since clock was instantiated 
            
            object.rotation.y -= 0.005;
            object.getObjectByName('capsule', true).rotation.x += 0.005;// * Math.PI / 180;

            if(controls){
                controls.update();
            }
            render();            
        }
    
        function render(){
            renderer.render( scene, camera );
        }
    </script>

</body>
</html>