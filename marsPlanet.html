<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salman Razak ::|:: Being creative mean be different...</title>
    <link rel="stylesheet" href="./assets/css/three.css">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HR8J8853HV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HR8J8853HV');
</script>
<body>

    <div id="container">
        <button type="button" class="backBtn" onclick="window.location.replace('three-js.html');">Back</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "./assets/build/three.module.js",
                "three/addons/": "./assets/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';

        const container = document.getElementById('container');

        const loader = new THREE.TextureLoader();
        let mars, earth, moon, scene, camera, renderer, controls, stars;
        let pointLight;
        let moonTexture, geometry, material;
        let light, directionalLight, helper;
        var r = 50, theta = 0, dTheta = 2 * Math.PI / 1000;
        let marsTexture = './assets/media/planet/5672_marsmap2k.jpg';
        let marsDisplacementTexture = './assets/media/planet/5672_mars_2k_topo.jpg';
        let marsBumpTexture = './assets/media/planet/5672_mars_2k_normal.jpg';

        init().then( animate );

        async function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x05060b );
            
            camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, 1000 );
            camera.position.z = 35; //scene.add( new THREE.CameraHelper( camera ) );
            
            renderer = new THREE.WebGLRenderer({ antialias: true});
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            container.appendChild( renderer.domElement );

            poinlights();
            
            model();

            starsGeometry();

            controlSetting();
            
            window.addEventListener('resize', onWindowResize);
        }

        function model(){
            geometry = new THREE.SphereGeometry( 16, 128, 64 );
            material = new THREE.MeshStandardMaterial({
                map : loader.load( marsTexture ),
                bumpMap: loader.load( marsBumpTexture ),
                bumpScale: 0.6,
                fog: false,
            });
            mars = new THREE.Mesh( geometry, material );
            mars.name = "MARS";
            scene.add(mars);
        }

        function poinlights(){
            pointLight = new THREE.PointLight( 0xffffff, 6, 100 );
            pointLight.position.set( 0, 50, 50 );
            scene.add( pointLight ); //scene.add( new THREE.PointLightHelper( pointLight, 1 ) );

            pointLight = new THREE.PointLight( 0xffffff, 1, 100 );
            pointLight.position.set( 0, -20, -20 );
            scene.add( pointLight ); //scene.add( new THREE.PointLightHelper( pointLight, 1 ) );

            new FontLoader().load('./assets/fonts/Sigmar_Regular.json', function ( font ) {

                const matDark = new THREE.LineBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide } );

                const matLite = new THREE.MeshBasicMaterial( {
                    color: 0xffffff,
                    transparent: true,
                    side: THREE.DoubleSide
                } );

                const shapes = font.generateShapes( mars.name, 3.5 );
                const geometry = new THREE.ShapeGeometry( shapes );

                geometry.computeBoundingBox();

                const xMid = - 0.5 * ( geometry.boundingBox.max.x - geometry.boundingBox.min.x );
                const yMid = - 0.5 * ( geometry.boundingBox.max.y - geometry.boundingBox.min.y );
                geometry.translate( xMid, yMid, 0 );

                const text = new THREE.Mesh( geometry, matLite );
                text.position.z = 20;
                scene.add( text );

                }, function ( xhr ) {
                    console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );
                }, function ( err ) {
                console.log( 'An error happened' );
            });

        }

        function controlSetting(){
            controls = new OrbitControls( camera, renderer.domElement );
            controls.enableZoom = true;
            controls.enableDamping = true;
            controls.minDistance = 4;
            controls.maxDistance = 50;
        }

        function starsGeometry(){

            const radius = 1000, particles = 10000, starVertices = [], colors = [], sizes = [], color = new THREE.Color();
            const starGeometry = new THREE.BufferGeometry();
            for ( let i = 0; i < particles; i ++ ) {
                const x = ( Math.random() * 1.5 - 1 ) * radius;
                const y = ( Math.random() * 1.5 - 1 ) * radius;
                const z = ( Math.random() * 1.5 - 1 ) * radius;
                starVertices.push(x,y,z);
                color.setHSL( i / particles, 1.0, 0.5 );
                colors.push( color.r, color.g, color.b );
                sizes.push( 20 );
            }
            starGeometry.setAttribute( 'position', new THREE.Float32BufferAttribute(starVertices, 3) );
            starGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 10 ) );
            starGeometry.setAttribute( 'size', new THREE.Float32BufferAttribute( sizes, 0.5 ).setUsage( THREE.DynamicDrawUsage ) );
            stars = new THREE.Points( starGeometry, new THREE.PointsMaterial({
                size: 0.001,
                alphaMap: new THREE.TextureLoader().load( './assets/media/lensflare/star.png' ),
                map: new THREE.TextureLoader().load( './assets/media/lensflare/star.png' ),
                color: 0xffffff,
                transparent: true
            }) );
            scene.add( stars );
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame( animate );
            
            if(controls){
                controls.update();
            }
            
            theta -= dTheta;
            mars.rotation.y -= 0.0005;
            stars.rotation.y += 0.0002;
            
            pointLight.position.x = r * Math.cos(theta);
            pointLight.position.z = r * Math.sin(theta);

            render();
        }

        function render(){
            renderer.render( scene, camera );
        }
    </script>

</body>
</html>